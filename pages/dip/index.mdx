import {MainLayout} from '~/layouts/main'
import {Figure} from '~/components/Figure'
import {Quiz} from '~/components/Quiz'

export const meta = {
  title: 'DIP | Введение',
  description: 'Введение в принцип инверсии зависимостей, его смысл, основные понятия'
}

export default ({ children }) => <MainLayout meta={meta}>{children}</MainLayout>

# Введение

Программные системы состоят из модулей, которые мы можем условно поделить на низкоуровневые и высокоуровневые.

_Низкоуровневые_ содержат утилитарную функциональность: обращение к базе данных, запросы к серверу, рендеринг DOM-элементов на странице.

_Высокоуровневые_ содержат сложную, более абстрактную бизнес-логику. Они достаточно абстрактны, чтобы их можно было переиспользовать в разных проектах: авторизация пользователей, валидация форм, отправка уведомлений.

В устойчивых системах высокоуровневые модули, как правило, не требуют обновления при изменении низкоуровневых. Добиться подобной устойчивости помогает принцип инверсии зависимостей.

## Принцип инверсии зависимостей

[Принцип инверсии зависимостей](https://ru.wikipedia.org/wiki/Принцип_инверсии_зависимостей) (Dependency Inversion Principle, DIP) предполагает, что:
- Высокоуровневые модули не должны зависеть от низкоуровневых; оба типа должны зависеть от абстракций.
- Абстракции не должны зависеть от деталей, детали должны зависеть от абстракций.

Таким образом DIP помогает снизить [зацепление модулей](https://ru.wikipedia.org/wiki/Зацепление_(программирование)) (coupling).

Когда модули жёстко зацеплены, они слишком много знают друг о друге и не функционируют по отдельности. В такой ситуации изменения в одном будут требовать изменений в других — что нарушает [OCP](/ocp).

## Зацепление и связность

_Зацепление_ (coupling) не стоит путать со _связностью_ (cohesion).

[Зацепление](https://ru.wikipedia.org/wiki/Зацепление_(программирование)) — степень взаимозависимости разных модулей. Чем выше зацепление, тем более хрупкой получается система, и тем сложнее вносить изменения.

[Связность](https://ru.wikipedia.org/wiki/Связность_(программирование)) — степень, в которой задачи некоторого модуля, связаны друг с другом. Чем выше связность, тем строже модули следуют [SRP](/srp), тем выше сфокусирован модуль на конкретной задаче.

## Абстракции

Согласно принципу модули должны зависеть от других модулей не напрямую, а от абстракций.

В [примере c регулятором температуры](http://stg-tud.github.io/sedc/Lecture/ws13-14/3.5-DIP.html#mode=document) на схеме ниже структура системы нарушает DIP. Модули зависят напрямую от других модулей, это увеличивает зацепление.

<Figure>
  <img src='/dip-violation.svg' />
  <figcaption>Модули зависят от конкретных модулей, это увеличивает зацепление</figcaption>
</Figure>

Исправленный вариант вводит прослойку между сущностями в виде абстракций — интерфейсов.

Модулям теперь не обязательно работать с конкретными модулями, они могут работать с любой сущностью, которая реализует указанный интерфейс. Так снижается зацепление.

<Figure>
  <img src='/dip-compliance.svg' />
  <figcaption>Абстракции в виде интерфейсов позволяют снизить зацепление</figcaption>
</Figure>

## DIP и тестируемость

При тестировании модуля, который зависит от других модулей, нам нужно либо создавать экземпляр каждой зависимости, либо создать заглушки.

 DIP упрощает тестирование системы. Если модули зависят от интерфейсов, нам достаточно создать заглушку, реализующую этот интерфейс.

## Коротко
Принцип инверсии зависимостей:
- вводит правила и ограничения для зависимости одних модулей от других;
- снижает зацепление модулей;
- делает тестирование модулей проще;
- позволяет проектировать систему так, чтобы модули были заменяемы на другие.

## Материалы к разделу
- [Принцип инверсии зависимостей, Википедия](https://ru.wikipedia.org/wiki/Принцип_инверсии_зависимостей)
- [Принцип инверсии зависимостей, Александр Бындю](https://blog.byndyu.ru/2009/12/blog-post.html)
- [Принцип инверсии зависимостей, MakeDev](https://makedev.org/principles/solid/dip.html)
- [Зацепление модулей](https://ru.wikipedia.org/wiki/Зацепление_(программирование))
- [Связность модулей](https://ru.wikipedia.org/wiki/Связность_(программирование))
- [General Responsibility Assignment Software Patterns, GRASP](https://ru.wikipedia.org/wiki/GRASP)
- [Inversion of Control Containers and the Dependency Injection pattern](https://martinfowler.com/articles/injection.html)
- [Пример с терморегулятором](http://stg-tud.github.io/sedc/Lecture/ws13-14/3.5-DIP.html#mode=document)

## Вопросы
<Quiz name='dip-intro-1' />
<Quiz name='dip-intro-2' />
<Quiz name='dip-intro-3' />
